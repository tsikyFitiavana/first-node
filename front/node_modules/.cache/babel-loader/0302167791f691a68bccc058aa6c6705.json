{"ast":null,"code":"var _ = require('lodash');\n\nvar url = require('url');\n\nvar ERRORS = require('./errors');\n\nvar logger = require('./logger').getInstance();\n\nmodule.exports = {\n  createConfig: createConfig\n};\n\nfunction createConfig(context, opts) {\n  // structure of config object to be returned\n  var config = {\n    context: undefined,\n    options: {} // app.use('/api', proxy({target:'http://localhost:9000'}));\n\n  };\n\n  if (isContextless(context, opts)) {\n    config.context = '/';\n    config.options = _.assign(config.options, context); // app.use('/api', proxy('http://localhost:9000'));\n    // app.use(proxy('http://localhost:9000/api'));\n  } else if (isStringShortHand(context)) {\n    var oUrl = url.parse(context);\n    var target = [oUrl.protocol, '//', oUrl.host].join('');\n    config.context = oUrl.pathname || '/';\n    config.options = _.assign(config.options, {\n      target: target\n    }, opts);\n\n    if (oUrl.protocol === 'ws:' || oUrl.protocol === 'wss:') {\n      config.options.ws = true;\n    } // app.use('/api', proxy({target:'http://localhost:9000'}));\n\n  } else {\n    config.context = context;\n    config.options = _.assign(config.options, opts);\n  }\n\n  configureLogger(config.options);\n\n  if (!config.options.target) {\n    throw new Error(ERRORS.ERR_CONFIG_FACTORY_TARGET_MISSING);\n  } // Legacy option.proxyHost\n\n\n  config.options = mapLegacyProxyHostOption(config.options); // Legacy option.proxyTable > option.router\n\n  config.options = mapLegacyProxyTableOption(config.options);\n  return config;\n}\n/**\n * Checks if a String only target/config is provided.\n * This can be just the host or with the optional path.\n *\n * @example\n *      app.use('/api', proxy('http://localhost:9000'));\n        app.use(proxy('http://localhost:9000/api'));\n *\n * @param  {String}  context [description]\n * @return {Boolean}         [description]\n */\n\n\nfunction isStringShortHand(context) {\n  if (_.isString(context)) {\n    return !!url.parse(context).host;\n  }\n}\n/**\n * Checks if a Object only config is provided, without a context.\n * In this case the all paths will be proxied.\n *\n * @example\n *     app.use('/api', proxy({target:'http://localhost:9000'}));\n *\n * @param  {Object}  context [description]\n * @param  {*}       opts    [description]\n * @return {Boolean}         [description]\n */\n\n\nfunction isContextless(context, opts) {\n  return _.isPlainObject(context) && _.isEmpty(opts);\n}\n\nfunction mapLegacyProxyHostOption(options) {\n  // set options.headers.host when option.proxyHost is provided\n  if (options.proxyHost) {\n    logger.warn('*************************************');\n    logger.warn('[HPM] Deprecated \"option.proxyHost\"');\n    logger.warn('      Use \"option.changeOrigin\" or \"option.headers.host\" instead');\n    logger.warn('      \"option.proxyHost\" will be removed in future release.');\n    logger.warn('*************************************');\n    options.headers = options.headers || {};\n    options.headers.host = options.proxyHost;\n  }\n\n  return options;\n} // Warn deprecated proxyTable api usage\n\n\nfunction mapLegacyProxyTableOption(options) {\n  if (options.proxyTable) {\n    logger.warn('*************************************');\n    logger.warn('[HPM] Deprecated \"option.proxyTable\"');\n    logger.warn('      Use \"option.router\" instead');\n    logger.warn('      \"option.proxyTable\" will be removed in future release.');\n    logger.warn('*************************************');\n    options.router = _.clone(options.proxyTable);\n\n    _.omit(options, 'proxyTable');\n  }\n\n  return options;\n}\n\nfunction configureLogger(options) {\n  if (options.logLevel) {\n    logger.setLevel(options.logLevel);\n  }\n\n  if (options.logProvider) {\n    logger.setProvider(options.logProvider);\n  }\n}","map":null,"metadata":{},"sourceType":"script"}